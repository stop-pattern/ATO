//Headder for ATS Plugin
//Author Tetsu Otter
#pragma once
#include "./pch.h"

//DLL importを短縮
#define DE extern "C" __declspec(dllexport)
//何のためか忘れたけど入れとく
#define SC __stdcall
//プラグインのバージョン
#define PI_VERSION 0x00020000

struct Spec		//列車のスペックに関する情報
{
	int B = 0;	//ブレーキ段数
	int P = 0;	//ノッチ段数
	int A = 0;	//ATS確認段数
	int J = 0;	//常用段数67度相当
	int C = 0;	//編成車両数
	int E = 0;	//非常段数
};
struct State		//列車状態に関する情報
{
	double Z = 0;	//列車位置[m]
	double V = 0;	//列車速度[km/h]
	int T = 0;		//0時からの経過時間[ms]
	double BC = 0;	//BC圧力[kPa]
	double MR = 0;	//MR圧力[kPa]
	double ER = 0;	//ER圧力[kPa]
	double BP = 0;	//BP圧力[kPa]
	double SAP = 0;	//SAP圧力[kPa]
	double I = 0;	//電流[A]
	double A = 0;	//加減速度[km/h/s]
};
struct Hand		//ハンドル位置に関する情報
{
	int B = 0;	//ブレーキハンドル位置
	int P = 0;	//ノッチハンドル位置
	int R = 0;	//レバーサーハンドル位置
	int C = 0;	//定速制御状態
};
struct Beacon		//Beaconに関する情報
{
	int Num = 0;	//Beaconの番号
	int Sig = 0;	//対応する閉塞の現示番号
	double X = 0;	//対応する閉塞までの距離[m]
	int Data = 0;	//Beaconの第三引数の値
};

enum Reverser	//レバーサー位置
{
	Back = -1,	//後進
	Neutral,	//中立
	Forward		//前進
};
enum ConstSPInfo//定速制御の状態
{
	Continue,	//前回の状態を継続する
	Enable,		//有効化する
	Disable		//無効化する
};
enum HornInfo	//警笛の番号
{
	Horn1,		//Primary Horn
	Horn2,		//Secondary Horn
	MusicHorn	//Horn Music
};
enum SoundInfo	//サウンドの操作情報
{
	PlayLoop,	//繰り返し再生する
	PlayOnce,	//1度だけ再生する
	PlayContinue,	//前回の状態を継続する
	Stop = -1000//再生を停止する
};
enum InitialPosition	//ハンドルの初期位置設定
{
	Service,			//常用ブレーキ(B67?)
	Emergency,			//非常ブレーキ(EB)
	Removed				//抜き取り位置
};
enum ATSKeys	//キー押下情報
{
	S,	//space
	A1,	//home
	A2,	//end
	B1,	//insert
	B2,	//delete
	C1,	//page up
	C2,	//page down
	D,	//2
	E,	//3
	F,	//4
	G,	//5
	H,	//6
	I,	//7
	J,	//8
	K,	//9
	L,	//0
};



DE void SC Load(void);
DE void SC Dispose(void);
DE int SC GetPluginVersion(void);
DE void SC SetVehicleSpec(Spec);
DE void SC Initialize(int);
DE Hand SC Elapse(State, int*, int*);
DE void SC SetPower(int);
DE void SC SetBrake(int);
DE void SC SetReverser(int);
DE void SC KeyDown(int);
DE void SC KeyUp(int);
DE void SC HornBlow(int);
DE void SC DoorOpen(void);
DE void SC DoorClose(void);
DE void SC SetSignal(int);
DE void SC SetBeaconData(Beacon);